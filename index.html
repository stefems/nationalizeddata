<!DOCTYPE html>
<html>
	<head>
		<link rel="shortcut icon" type="image/png" href="/favicon.png"/>
		<title>Place searches</title>
		<link rel="stylesheet" type="text/css" href="./styles.css">
	    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
	    <meta charset="utf-8">
	   <style>
	      /* Optional: Makes the sample page fill the window. */
	      html, body {
	        height: 100%;
	        margin: 0;
	        padding: 0;
	      }
	    </style>
    	<script>
			var map;
			var infowindow;

			function initMap() {
				var pyrmont = {lat: -33.867, lng: 151.195};

				map = new google.maps.Map(document.getElementById('map'), {
					center: pyrmont,
					zoom: 15
				});

				infowindow = new google.maps.InfoWindow();
				var service = new google.maps.places.PlacesService(map);
				service.nearbySearch({
					location: pyrmont,
					radius: 500,
					type: ['store']
				}, callback);
				infowindow = new google.maps.InfoWindow;
				getLocation();
			}

			function callback(results, status) {
				if (status === google.maps.places.PlacesServiceStatus.OK) {
					for (var i = 0; i < results.length; i++) {
						createMarker(results[i]);
					}
				}
			}

			function createMarker(place) {
				var placeLoc = place.geometry.location;
				var marker = new google.maps.Marker({
					map: map,
					position: place.geometry.location
				});

				google.maps.event.addListener(marker, 'click', function() {
					infowindow.setContent(place.name);
					infowindow.open(map, this);
				});
			}

			function getLocation() {
				// Try HTML5 geolocation.
		        if (navigator.geolocation) {
		          navigator.geolocation.getCurrentPosition(function(position) {
		            var pos = {
		              lat: position.coords.latitude,
		              lng: position.coords.longitude
		            };

		            infowindow.setPosition(pos);
		            infowindow.setContent('Location found.');
		            infowindow.open(map);
		            map.setCenter(pos);
		          }, function() {
		            handleLocationError(true, infowindow, map.getCenter());
		          });
		        } 
		        else {
		          // Browser doesn't support Geolocation
		          handleLocationError(false, infowindow, map.getCenter());
		        }
				function handleLocationError(browserHasGeolocation, infowindow, pos) {
					infowindow.setPosition(pos);
					infowindow.setContent(browserHasGeolocation ?
					  'Error: The Geolocation service failed.' :
					  'Error: Your browser doesn\'t support geolocation.');
					infowindow.open(map);
				}
			}
    	</script>

	</head>	
	<body>
		<h1>Nationalized Data</h1>
		<div><div id="map"></div></div>
		<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAC4bVTmV7z7rkLOVmXgxlRBsuYOqaAvQU&libraries=places&callback=initMap" async defer></script>
	</body>
</html>



